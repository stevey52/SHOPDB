{% extends 'shop/base.html' %}

{% block title %}Dashboard - BOMBA MOTORS{% endblock %}
{% block header_title %}Dashboard{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card glass">
        <div class="stat-label">Total Products</div>
        <div class="stat-value">{{ total_products }}</div>
    </div>
    <div class="stat-card glass">
        <div class="stat-label">Low Stock</div>
        <div class="stat-value text-danger">{{ low_stock }}</div>
    </div>
    {% if is_manager %}
    <div class="stat-card glass">
        <div class="stat-label">Total Income</div>
        <div class="stat-value text-success">TZS {{ total_income }}</div>
    </div>
    <div class="stat-card glass">
        <div class="stat-label">Total Expense</div>
        <div class="stat-value text-danger">TZS {{ total_expense }}</div>
    </div>
    <div class="stat-card glass">
        <div class="stat-label">Balance</div>
        <div class="stat-value {% if balance >= 0 %}text-success{% else %}text-danger{% endif %}">TZS {{ balance }}
        </div>
    </div>
    {% endif %}
</div>

{% if is_manager %}
<div class="content-section glass" style="padding: 1.5rem;">
    <h3>Sales & Profit Trends (Last 7 Days)</h3>
    <div style="height: 400px; margin-top: 1.5rem;">
        <canvas id="performanceChart"></canvas>
    </div>
</div>
{% else %}
<div class="content-section glass" style="padding: 1.5rem; text-align: center;">
    <h3>Welcome, {{ user.username }}!</h3>
    <p style="color: var(--text-secondary); margin-top: 1rem;">Ready to make some sales?</p>
    <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
        <a href="{% url 'sale_create' %}" class="btn btn-primary">
            <i data-lucide="shopping-cart" style="vertical-align: middle; width: 18px; margin-right: 5px;"></i> New Sale
        </a>
        <a href="{% url 'product_list' %}" class="btn glass" style="color: white; text-decoration: none;">
            <i data-lucide="package" style="vertical-align: middle; width: 18px; margin-right: 5px;"></i> View Products
        </a>
    </div>
</div>
{% endif %}

{% block extra_js %}
{% if is_manager %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('performanceChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_labels| safe }},
        datasets: [{
            label: 'Sales (TZS)',
            data: {{ chart_sales| safe }},
        borderColor: '#38bdf8',
        backgroundColor: 'rgba(56, 189, 248, 0.1)',
        borderWidth: 3,
        tension: 0.4,
        fill: true
        }, {
            label: 'Profit (TZS)',
            data: {{ chart_profit| safe }},
        borderColor: '#10b981',
        backgroundColor: 'rgba(16, 185, 129, 0.1)',
        borderWidth: 3,
        tension: 0.4,
        fill: true
        }, {
            label: 'Expenses (TZS)',
            data: {{ chart_expenses| safe }},
        borderColor: '#f43f5e',
        backgroundColor: 'rgba(244, 63, 94, 0.1)',
        borderWidth: 3,
        tension: 0.4,
        fill: true
        }]
    },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: {
                    color: '#94a3b8',
                    font: { family: 'Inter' }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                ticks: { color: '#94a3b8' }
            },
            x: {
                grid: { display: false },
                ticks: { color: '#94a3b8' }
            }
        }
    }
    });
</script>
{% endif %}
{% endblock %}
{% endblock %}